<%- include ('../../partials/header') %>
<div class="col"><%- include ('../../partials/message') %></div>

<!-- Adding Bootstrap JavaScript-->
<script
src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
crossorigin="anonymous">
</script>

<main>
    <div class="container">
      <!-- THE REST OF YOUR HTML CODE GOES HERE -->
      <h1>December Budget</h1>
      <%- include ('../../partials/budgetNav') %>


      <!--Modal Section-->
       <!-- Button to trigger the modal -->
       <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addExpenseModal">
        Add Expense
    </button>

    <!-- Modal for adding expenses -->
    <div class="modal fade" id="addExpenseModal" tabindex="-1" aria-labelledby="addExpenseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addExpenseModalLabel">Add Expense</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Your form for adding expenses -->
                    <form id="addExpenseForm" method="post" action="/addExpense">
                        <!-- Add input fields here for the expense details -->
                        <div class="mb-3">
                            <label for="category" class="form-label">Category:</label>
                            <select class="form-select" id="category" name="category" required>
                            <option value="Salary">Salary</option>
                            <option value="Investments">Investments</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Food">Food</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Other">Other</option>
                        </select>

                        </div>
                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount:</label>
                            <input type="number" class="form-control" id="amount" name="amount" oninput="updateTotal()" required >
                        </div>

                        <div class="mb-3">
                            <label for="total" class="form-label">Total:</label>
                            <input type="number" class="form-control" id="total" name="total" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="label" class="form-label">Label:</label>
                            <input type="text" class="form-control" id="label" name="label" required>
                        </div>

                        <!-- Add more fields as needed -->

                        <button type="submit" class="btn btn-primary">Add Expense</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--Diplay existing expenses-->
      <% if (expenses && expenses.length > 0) { %>
        <% console.log("in expenses")%>
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Index ID</th>
              <th scope="col">Category</th>
              <th scope="col">Amount</th>
              <th scope="col">Total</th>
              <th scope="col">Label</th>
              <th scope="col">Actions</th> <!-- Add this column for Delete button -->
            </tr>
          </thead>
          <tbody>
            <% expenses.forEach(expense => { %>
              <tr>
                <td><%= expense.index_id %></td>
                <td><%= expense.category %></td>
                <td><%= expense.amount %></td>
                <td><%= expense.total %></td>
                <td><%= expense.label %></td>
              
              <!-- Add a form for each expense with a delete button -->
              <td>
                <!-- Move the form here so that it is within the same table row -->
                <form method="post" action="/deleteExpense">
                    <input type="hidden" name="expenseId" value="<%= expense.index_id %>">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No expenses found for February.</p>
      <% } %>
    

      <!--Function to update the total -->
      <script>
        function updateTotal() {
            // Get the value from the Amount input
            const amountInput = document.getElementById('amount');
            const amountValue = parseFloat(amountInput.value) || 0;
    
            // Update the Total input with the calculated value
            const totalInput = document.getElementById('total');
            totalInput.value = amountValue.toFixed(2); // Assuming we want two decimal places
        }
    </script>


  </main>

  <%- include ('../../partials/footer') %>